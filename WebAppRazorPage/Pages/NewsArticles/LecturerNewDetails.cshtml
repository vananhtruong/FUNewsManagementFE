@page
@{
    ViewData["Title"] = "LecturerNewDetails";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
    <div class="container py-5">
        <article id="articleContainer" class="bg-white p-4 rounded shadow-sm d-none">
            <header class="mb-4">
                <h1 id="newsTitle" class="fw-bold display-5"></h1>
                <p id="headline" class="lead text-muted"></p>
                <div class="d-flex flex-wrap justify-content-between text-muted small">
                    <div>
                        <span><strong>Created Date:</strong> <span id="createdDate"></span></span> |
                        <span><strong>Update Date:</strong> <span id="modifiedDate"></span></span>
                    </div>
                    <div>
                        <span><strong>Author:</strong> <span id="author"></span></span> |
                        <span><strong>Category:</strong> <span id="category"></span></span>
                    </div>
                </div>
            </header>

            <section class="mb-4">
                <p id="newsContent" class="fs-5" style="text-align: justify; line-height: 1.8;"></p>
            </section>

            <footer class="border-top pt-3 mt-4">
                <p><strong>Source: </strong> <em id="newsSource"></em></p>
                <div>
                    <strong>Tags:</strong> <span id="tagsArea" class="ms-1"></span>
                </div>
            </footer>

            <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-secondary" onclick="window.history.back();">
                    ← Back
                </button>
            </div>
        </article>

        <div id="errorBox" class="alert alert-danger d-none text-center mt-4">
            ❌ Failed to load article details. Please try again later.
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get("id");
            const token = localStorage.getItem("jwtToken");

            if (!id || !token) {
                document.getElementById("errorBox").classList.remove("d-none");
                return;
            }

            try {
                const response = await fetch(`https://localhost:7126/api/NewsArticle/${id}`, {
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                });

                if (!response.ok) throw new Error("Request failed");

                const data = await response.json();

                // Fill data into the UI
                document.getElementById("newsTitle").innerText = data.newsTitle;
                document.getElementById("headline").innerText = data.headline;
                document.getElementById("createdDate").innerText = formatDate(data.createdDate);
                document.getElementById("modifiedDate").innerText = formatDate(data.modifiedDate);
                document.getElementById("author").innerText = data.createdBy?.accountName || "N/A";
                document.getElementById("category").innerText = data.category?.categoryName || "N/A";
                document.getElementById("newsContent").innerHTML = data.newsContent;
                document.getElementById("newsSource").innerText = data.newsSource;

                if (data.tags && data.tags.length > 0) {
                    document.getElementById("tagsArea").innerHTML = data.tags.map(tag =>
                        `<span class="badge bg-info text-dark me-1">${tag.tagName}</span>`
                    ).join('');
                } else {
                    document.getElementById("tagsArea").innerHTML = '<span class="text-muted">N/A</span>';
                }

                document.getElementById("articleContainer").classList.remove("d-none");

            } catch (err) {
                console.error(err);
                document.getElementById("errorBox").classList.remove("d-none");
            }

            function formatDate(dateStr) {
                if (!dateStr) return "N/A";
                const date = new Date(dateStr);
                return date.toLocaleDateString("vi-VN");
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
