@page
@model FUNewsManagementSystem.Pages.NewsArticles.DeleteModel
@{
    ViewData["Title"] = "Delete Article";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="card shadow">
            <div class="card-body text-center">
                <h2 class="text-danger">⚠️ Confirm Delete</h2>
                <p class="lead">Are you sure you want to delete this article?</p>
                <h4 id="articleTitle" class="fw-bold text-dark"></h4>

                <div class="mt-4">
                    <button id="confirmDeleteBtn" class="btn btn-danger me-2">🗑️ Confirm Delete</button>
                    <a href="/NewsArticles/Index" class="btn btn-secondary">❌ Cancel</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const articleId = new URLSearchParams(window.location.search).get("id");
        const token = localStorage.getItem("jwtToken");
        const apiBase = "https://localhost:7126/api";

        async function loadArticleTitle() {
            const res = await fetch(`${apiBase}/NewsArticle/${articleId}`, {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            });

            if (res.ok) {
                const article = await res.json();
                document.getElementById("articleTitle").textContent = article.newsTitle;
            } else {
                alert("❌ Failed to load article details.");
                window.location.href = "/NewsArticles/Index";
            }
        }

        document.getElementById("confirmDeleteBtn").addEventListener("click", async () => {
            const res = await fetch(`${apiBase}/NewsArticle/${articleId}`, {
                method: "DELETE",
                headers: {
                    Authorization: `Bearer ${token}`
                }
            });

            if (res.ok) {
                alert("✅ Article deleted successfully!");
                window.location.href = "/NewsArticles/Index";
            } else {
                alert("❌ Failed to delete the article.");
            }
        });

        loadArticleTitle();
    </script>
</body>
</html>
